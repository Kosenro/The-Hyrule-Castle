import * as rl from 'readline-sync';
import { Persona } from './Persona';
import mm from './mod_manager';
import je from './json_editor';

function displaystart() {
  console.log(
    '                ~5P.                                                                                \n',
    '               .7GB^                                                                                \n',
    '                ^55                                                                                 \n',
    '                ^55                                                                                 \n',
    '                ^55                                                                                 \n',
    '                ^55                                                                                 \n',
    '                ^55                                                                                 \n',
    '            !7^~7PBJ::?^                                                                            \n',
    '         .7YP5Y5J?PYP55PY~                                                                          \n',
    '        .?GPP~.~JJGP~.75PB!                                                                         \n',
    '    ....:~^^:..:75BY ..:^~!......    ...... ......   ..  ... ... ...... . ...    ... ...            \n',
    '   :7!!7!777777!7JPJ7777777777777^  ..!^.:!.!::!::   !^ .!^::!.^:^!:::!^!.^~.!. ^~:~^~~:.           \n',
    '  .!77777!~~~~!!?JJ?7~~!777!7777^     ^. .^ ^..^.:   ^::.^::.^.^.:^...: : :^.:  .^::.^:             \n',
    '  !777~..     .7JJJY~ :77!^!77~. ....  .....  ....... .....   ...... .            .......           \n',
    ' ^7!^.         .?JJY^~77^:!77.  .!777!!777777!7~^!!77777!^^   :!777!!77!!^..      ^!77777^ ..       \n',
    '^~:            !JY5J77!..!7!:    .!7777~.:::!77~  ^77777:       :77777^~7777~.     .!77777.         \n',
    '               JG5?7!: :77~.      ~7777^    .!7~  ^77777:       .7777!  :77777.    :!77777~         \n',
    '               7Y777. ^77:        !7777~   ...7~  ^77777:       .7777!   :7777!.  .!7777777:        \n',
    '               77777!77!.         !7777~  ^7~ ::  ^77777:       .77777.   !7777^  ~77!!7777!        \n',
    '             .~7?JJ777^   ~: ..   !77777!777^     ^77777:       .77777.   ~7777~ :777:^77777:       \n',
    '            :!77?J?7!: ^~~77!~.   ~7777~.^77~  .  :77777:    :: .77777.   ~7777~ ~777^:!7777!       \n',
    '           ^7!^!777?.   ~!!!!:..  ^7777^  .~^ ~~  ^77777:   :7: .77777.   !7777:^777777777777^      \n',
    '         :!7^ .!77J?.     .:..^!: !7777~     ~?~  ^77777:  :77: .7777!.  ^7777!.777~....77777!      \n',
    '        ^77: ^77?Y55: .:..^^.     !7777^    ^7!:  ^77777: .!77^ .77777. ^7777!.~77!     ^77777~     \n',
    '      .~77.:!77?GGG#:  :^!~^.   .~77777!~^~~777~ .~77777^~!777^ ^77777~!77!!^.^777~     :777777.    \n',
    '     :77!:~77!.~GB#P.   :.    .^77!!!!!!!!!!~~!~^!!!!~!!!!!!^!~~!!!~^~!~^:. ^!~~!!!~.  .:!!!!!!~~:  \n',
    '   .~77!~777^  7GBBG:  ^.  .^!777. ::::.  ....  ...:  .:  ...:..:..:  .....  .:.  :  .. .. .:. .::. \n',
    '  :!77777777777JBBB#7!7777777777^  ^7~:7~ ^7:!~ ^7:^. ~7^.:^7:::7:^7 :~~~~.  .!! :7: !^ ~! ^7  .7:^~\n',
    ' :!!!!~!!!!!!!!JGBB#?!!!!!!!!!~:   :7~^7^ ^7~!. ^7::.:~^7. ^7  :7:~7 .^:::... .7~!!!~~  ~! :7.:.7:^!\n',
    '               7GBBB:              :?^ ~7::^.:: :^:^.^. ^: :^. :^.:^. ^^:~~:!: ^?^.!!   :^ :^:^.^:: \n',
    '               ~PBB#:              ^!~^~^.                            ...::.:.  ^  ::               \n',
    '               ?BB5B:                                                                               \n',
    '               ~P5J5:                                                                               \n',
    '               .!JY?.                                                                               \n',
    '               .!75~                                                                                \n',
    '                :~7                                                                                 \n',
    '                 :.                                                                                 \n',
  );
}
function displaylose() {
  console.log(
    '           ....                    ________                                                         \n',
    '            ..      ...,.,,,,     /  _____/_____    _____   ____     _______  __ ___________        \n',
    '             ........,*,*****.   /   \\  ___\\__  \\  /     \\_/ __ \\   /  _ \\  \\/ // __ \\_  __ \\       \n',
    '       ....... .,. ,             \\    \\_\\  \\/ __ \\|  Y Y  \\  ___/  (  <_> )   /\\  ___/|  | \\/       \n',
    '     ,...,,* .**,*#%%             \\______  (____  /__|_|  /\\___  >  \\____/ \\_/  \\___  >__|          \n',
    '    ..,*     .#%%%&#%&                   \\/     \\/      \\/     \\/                   \\/              \n',
    '     ,        .(###%%#&                                                                             \n',
    '                (%(#&%%%.           *,*       /*,,(                                    ,            \n',
    '                 (%#%&%%&           *,,,    /,,,,,,,                                                \n',
    '                  (#%%&%%&          /***   /,,,,,,*                                                 \n',
    '.                  (%%%@#%&.    ..,,//((/,(/***,,*(                                                 \n',
    '                    %%%%&%%@*  .,,*/(%%%%&#(//***#        .                                         \n',
    '                     @@&%%&@@*.,*/(%&@@@@&%###/                                                     \n',
    '                      @@@@%@@@/.,/(#&@@@&&%#///.  .                                                 \n',
    '                       @@@@%@&&*,,*/(%&#((/#/***    ,                   .*////***/*.                \n',
    '                        #&@@#&%&/..,,,,,,,,..*#/                  *###(//*******/***/.              \n',
    '                         /%%&/%%&/  . ..                      .%#(/**///////////////*/*             \n',
    '                          /#%%*%%%(                         ,#(//***/***/***/***/*****/*.,          \n',
    '                           /#%%,%%&(                      .%(/******/*/*/*/*/*********/*,           \n',
    '                            /##%,%%&#                    ##/********/***/***/*//**/**/***.          \n',
    '                .            /#%%*&%&#                ,.*,...,,,,,*******/**//*/..,.**/**/          \n',
    ',.  .........,,,.., ...,,...../#%#*%#&%., ,,.,...,...@&&&&&&&&&&&&&&&&&&&&&&&&&%%#..,/****          \n',
    '...,,.*.,..,,,,,.,,,,,,. ..,,../##(*%%&%*....,.,,,,,%@%#*(%%#%%%%&%&&&%%%&%%%%&&&%/,.*****          \n',
    ',,,,,,,,.,.,,,.,*,,,,.,,,.,..,.,/%(/*#//,,..,.,,*,,,,((/%/((#(#&/(##&%%%/%&#%&%&%%,,..****          \n',
    '.*,*,,,....,,..,.,.,,.*,,,.,...,..,,,,. .,.....,.,.,.,.,.......,......,,,.*,**,.....,...*.          \n',
    ',,,,,,.,,.,,,..,,,,.,,,.,*......,,.,..... ...,....,*....*...,..*,,...,,,.....,,,...,,..,.,          \n',
    ',,*.,,.,,.,,,..,,.,,,,,,,.,,..,....,.,*.. ,,,,.,.,,,,..*..,..,..,,.,.,..,.,,,,,,.,,.,,.,,,          \n',
  );
}

function displaywin() {
  console.log(
    '  _____.___.               __      __.__         ._.                        .   %,#%%                \n',
    '  \\__ |   | ____  __ __  /  \\    /  \\__| ____   | |                       .   ## /%%                \n',
    '  /   |   |/  _ \\|  |  \\ \\   \\/\\/   /  |/    \\  | |                     .   %%.,#%%                 \n',
    '  \\____   (  <_> )  |  /  \\        /|  |   |  \\  \\|                    .   %# %%#%                  \n',
    '  / ______|\\____/|____/    \\__/\\  / |__|___|  /  __                   .  ,%,%%%%%                   \n',
    '  \\/                            \\/          \\/   \\/                  .   %./%*%%.                   \n',
    '                                                                   .  .%.%/%%%                      \n',
    '                                                                  .  /%(%%%%%                       \n',
    '                                                                .   %(*%%(%*                        \n',
    '                                                                   %(,%#%%.                         \n',
    '                                     ,&%//******(%,            /*%%/.#%%%                           \n',
    '                          .  *&&&&&#(((%///******/*,*&    ..  ##%#(###/(%*                          \n',
    '                          .   &&&&&%(((((&%%%#((/(%%/%    ..  /%///%#%%%%.                          \n',
    '                            ,&&&%&&&&&&##/ %%% ... %#%       %(,,*#/(#                              \n',
    '                        .&&((####&#(/%(#//*......... %*%%  %%(/%%#(%,   .                           \n',
    '                     /@((((#####%&@(&##((/,,/*/***,...%#/%#,,/%%%*                                  \n',
    '                    @/(/#########%&&&%(&///,,....... %&#,,,/&#((&                                   \n',
    '              .   @@((####%#%@@%&&&&&@&#((///,,,..,&,#*,*//(&&&%                                    \n',
    '             ..  &&(@@@&/      #@@@@@@@@@@&&&&&&&&&%*/*/(%%/                                        \n',
    '             .  ,&                   &@&&%***/#@(((%(/(&&%                                          \n',
    '             ..    ,   @//%@@@@@@@@@@@&##&///*(#(((&(@@(   .                                        \n',
    '                   ..  @//&(/,.......@@###(%/@((((((@@                                              \n',
    '                   .,  &#/%#(((((((@.@@#########((((%@                                              \n',
    '                   ..  @&(&#(#,((*(%,@@###%%##((#(((((@                                             \n',
    '                   ..  @@(&%%/((%#((,&@##%%%##(#(#(((((@(                                           \n',
    '                   ..  ,@(&%########,&@@%%%%%#########&@@@.                                         \n',
    '                    .   @(&%%######/*&@&@&%%%%&#/#*@@@@@#((&@                                       \n',
    '                    ..  @%(&%#####%/(@@@#@@@@@*&%/,@%###(#(#(@%                                     \n',
    '                     ..  *@##%#%%/%@@@/%%@@%%%%%&%#########(%%@&                                    \n',
    '                      .,   #@#(/&@@  &**/@@@@%%######%&@@@%((///#@*                                 \n',
    '                        .,   &@%    ,&@@@//*,*,*&@@.  *@@@(//(/***/&@/                              \n',
    '                         ...    .,   ,@%*/,,,@&     ,,    #@@&%&@&@&##@@                            \n',
  );
}
function displayTitleScreen() {
  console.log('   =====================================================================================================\n');
  console.log('                 ------------------------     Hyrule Castle     ------------------------                \n');
  console.log('   =====================================================================================================\n');
  console.log('                                1. New Game                  2. Quit                                   ');
  console.log('                                3. Mod manager          4. Modify Data                                 ');
  console.log('   =====================================================================================================');
}

function chooseDifficulty() : string {
  let bOk = true;
  do {
    console.log('\n   =====================================================================================================');
    console.log('                                             Difficulty ?               ');
    console.log('   =====================================================================================================');
    console.log('   |                         1. Normal     2. Difficult     3. Insane                                  |');
    console.log('   =====================================================================================================\n');
    bOk = true;
    switch (rl.question('Your choice : ')) {
      case '1': return '1';
      case '2': return '2';
      case '3': return '3';
      default: console.log('Choice invalid, retry'); bOk = false; break;
    }
  } while (bOk === false);
  return '0';
}

function chooseFloor() : string {
  let bOk = true;
  do {
    console.log('   \n=====================================================================================================');
    console.log('                                           Number of floor ?             ');
    console.log('   =====================================================================================================');
    console.log('   |                              1. 10     2. 20      3. 50      4. 100                               |');
    console.log('   =====================================================================================================\n');
    bOk = true;
    const choice = rl.question('Your choice : ');
    switch (choice) {
      case '1': return '10';
      case '2': return '20';
      case '3': return '50';
      case '4': return '100';
      default: console.log('Choice invalid, retry'); bOk = false; break;
    }
  } while (bOk === false);
  return '0';
}

function giveCoin(player : Persona, nbrCoin : number) {
  player.coins += nbrCoin;
}

function chooseStart() : string {
  let bOk = true;
  do {
    bOk = true;
    switch (rl.question('Your choice : ')) {
      case '1': return chooseDifficulty();
      case '2': return 'quit';
      case '3': mm.startModManager(); displayTitleScreen(); chooseStart(); break;
      case '4': je.JsonEditor(); displayTitleScreen(); chooseStart(); break;
      default: console.log('Choice invalid, retry'); bOk = false; break;
    }
  } while (bOk === false);
  return '';
}

function wait(ms) {
  const start = new Date().getTime();
  let end = start;
  while (end < start + ms) {
    end = new Date().getTime();
  }
}
function start() : string {
  displaystart();
  wait(3000);

  displayTitleScreen();
  let difficulty = chooseStart();
  if (difficulty === 'quit') { return '0'; }
  difficulty += ` ${chooseFloor()}`;

  return difficulty;
}

export default {
  start, displayTitleScreen, giveCoin, displaylose, displaystart, displaywin,
};
